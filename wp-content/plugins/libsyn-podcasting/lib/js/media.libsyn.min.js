jQuery(document).ready(function (e) {
	var t;
	e(document.body).on("click.libsynOpenFtpUnreleasedManager", ".libsyn-open-ftp_unreleased", function (n) {
		
		var removeData = function() {
			//remove ftp/unreleased
			jQuery.ajax({
				url : window.libsyn_admin_site_url + "?action=remove_ftp_unreleased&remove_ftp_unreleased=1",
				type: 'POST',
				data: window.libsyn_data_id,
				cache: false,
				dataType: 'json',
				processData: false, // Don't process the files
				contentType: false, // Set content type to false as jQuery will tell the server its a query string request
				success : function(data) {          
					//success
				},
				error : function(request,error)
				{
					//error
					//alert("Request: "+JSON.stringify(request));
				}
			});
		};
		
		//set input box to text
		jQuery("#libsyn-new-media-media").attr("type", "text");
		
		//add ftp/unreleased
		jQuery.ajax({
			url : window.libsyn_admin_site_url + "?action=load_libsyn_media&load_libsyn_media=1",
			type: 'POST',
			data: window.libsyn_data_id,
			cache: false,
			dataType: 'json',
			processData: false, // Don't process the files
			contentType: false, // Set content type to false as jQuery will tell the server its a query string request
			success : function(data) {          
				//success
				return n.preventDefault(),
				t ? void t.open() : (t = wp.media.frames.libsyn_media_frame = wp.media({
							className : "media-frame libsyn-ftp_unreleased-frame",
							frame : "select",
							multiple : false,
							title : libsyn_nmp_media.title,
							library : {
								type : ["libsyn/ftp-unreleased", "audio/ftp-unreleased", "video/ftp-unreleased"]
							},
							button : {
								text : libsyn_nmp_media.button
							}
						}), t.on("select", function () {
						var n = t.state().get("selection").first().toJSON();
						e("#libsyn-new-media-media").val(n.name).attr("readonly", true);
						removeData();
					}), void t.open()), t.on("close", function() { removeData(); })
			},
			error : function(request,error)
			{
				//error
				//alert("Request: "+JSON.stringify(request));
			}
		});

	});	
});
